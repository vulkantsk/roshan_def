
DONATE_SET_PREMIUM_1 = {
	players = {
		105803530
	},
}
	
DONATE_ITEMS = {
	heroes = {
		{
			name = "item_roshan_essence",
			can_be_bought = true,
			prices = {
				rub = 228,
				usd = 5,
			},
			count = 1,
			sets = {
				DONATE_SET_MARSHAL,
				DONATE_SET_PREMIUM_1,
				DONATE_SET_LIGHT_PACK,
			},
		},
		{
			name = "item_drow_ranger_essence",
			can_be_bought = true,
			count = 1,
			sets = {
				DONATE_SET_MARSHAL,
				DONATE_SET_PREMIUM_1,
				DONATE_SET_DROW_RANGER,
			},
		},
		{
			name = "item_meatboy_essence",
			can_be_bought = true,
			count = 1,
			sets = {
				DONATE_SET_MARSHAL,
				DONATE_SET_PREMIUM_1,
				DONATE_SET_MEATBOY,
			},
		},
		{
			name = "item_alchemist_essence",
			can_be_bought = true,
			count = 1,
			sets = {
				DONATE_SET_MARSHAL,
				DONATE_SET_PREMIUM_1,
				DONATE_SET_ALCHEMIST,
			},
		},
		{
			name = "item_sniper_essence",
			can_be_bought = true,
			count = 1,
			sets = {
				DONATE_SET_PREMIUM_1,
				DONATE_SET_SNIPER,
				DONATE_SET_MARSHAL,
			},
		},
		{
			name = "item_phantom_assassin_essence",
			can_be_bought = true,
			prices = {
				rub = 120,
				usd = 3,
			},
			count = 1,
			sets ={
				DONATE_SET_PREMIUM_1,
				DONATE_SET_PHANTOM_ASSASSIN,
				DONATE_SET_MARSHAL,
			},
		},
		{
			name = "item_test_essence",
			can_be_bought = true,
			count = 1,
			sets = {
				DONATE_SET_TEST_ITEM_1,
				DONATE_SET_VIP,
				DONATE_SET_MARSHAL,
			},
		},
		{
			name = "item_mark_essence",
			can_be_bought = true,
			count = 1,
			sets = {
				DONATE_SET_TEST_ITEM_1,
				DONATE_SET_VIP,
				DONATE_SET_MARSHAL,
			},
		},
		{
			name = "item_th_essence",
			can_be_bought = true,
			count = 1,
			sets = {
				DONATE_SET_TEST_ITEM_1,
				DONATE_SET_VIP,
				DONATE_SET_MARSHAL,
			},
		},
		{
			name = "item_dw_essence",
			can_be_bought = false,
			count = 1,
			sets = {
				DONATE_SET_MARSHAL,
			},
		},
		{
			name = "item_broodmother_essence",
			can_be_bought = false,
			count = 1,
			sets = {
				DONATE_SET_MARSHAL,
			},
		},
		{
			name = "item_ds_essence",
			can_be_bought = true,
			count = 1,
			sets = {
				DONATE_SET_DARKSEER,
				DONATE_SET_VIP,
				DONATE_SET_MARSHAL,
			},
		},
		{
			name = "item_zombie_essence",
			can_be_bought = true,
			count = 1,
			sets = {
				DONATE_SET_ZOMBIE,
				DONATE_SET_VIP,
				DONATE_SET_MARSHAL,
			},
		},
		{
			name = "item_sven_essence",
			can_be_bought = true,
			count = 1,
			sets = {
				DONATE_SET_SVEN,
				DONATE_SET_VIP,
				DONATE_SET_MARSHAL,
			},
		},
		{
			name = "item_spctr_essence",
			can_be_bought = true,
			count = 1,
			sets = {
				DONATE_SET_SPECTRE,
				DONATE_SET_VIP,
				DONATE_SET_MARSHAL,
			},
		},
		{
			name = "item_ta_essence",
			can_be_bought = true,
			count = 1,
			sets = {
				DONATE_SET_VIP,
				DONATE_SET_MARSHAL,
			},
		},
		{
			name = "item_jacob_essence",
			can_be_bought = true,
			count = 1,
			sets = {
				DONATE_SET_VIP,
				DONATE_SET_MARSHAL,
			},
		},
		{
			name = "item_strm_essence",
			can_be_bought = true,
			count = 1,
			sets = {
				DONATE_SET_VIP,
				DONATE_SET_MARSHAL,
			},
		},
		{
			name = "item_antars_essence",
			can_be_bought = true,
			count = 1,
			sets = {
				DONATE_SET_VIP,
				DONATE_SET_MARSHAL,
			},
		},
		{
			name = "item_tb_essence",
			can_be_bought = true,
			count = 1,
			sets = {
				DONATE_SET_DEMON,
				DONATE_SET_VIP,
				DONATE_SET_MARSHAL,
			},
		},
		{
			name = "item_tangin_essence",
			can_be_bought = true,
			count = 1,
			sets = {
				DONATE_SET_VIP,
				DONATE_SET_MARSHAL,
			},
		},
		{
			name = "item_jotaro_essence",
			can_be_bought = true,
			count = 1,
			sets = {
				DONATE_SET_VIP,
				DONATE_SET_MARSHAL,
			},
		},


	},
	artifacts = {
		{
			name = "item_ventors_gamble",
			can_be_bought = true,
			count = 1,
			sets ={
				DONATE_SET_MARSHAL,
				DONATE_SET_PREMIUM_1,
				DONATE_SET_LIGHT_PACK,
				DONATE_SET_VENTOR_GAMBLE,
			},
		},
		{
			name = "item_bonus_effect_green",
			can_be_bought = true,
			count = 1,
			sets ={
				DONATE_SET_MARSHAL,
				DONATE_SET_PREMIUM_1,
			},
		},
		{
			name = "item_bonus_effect_blue",
			can_be_bought = true,
			count = 1,
			sets ={
				DONATE_SET_MARSHAL,
				DONATE_SET_PREMIUM_1,
			},
		},
		{
			name = "item_bonus_effect_pink",
			can_be_bought = true,
			count = 1,
			sets ={
				DONATE_SET_MARSHAL,
				DONATE_SET_PREMIUM_1,
			},
		},
		{
			name = "item_bonus_tier_legendary",
			can_be_bought = true,
			count = 1,
			sets ={
				DONATE_SET_MARSHAL,
				DONATE_SET_PREMIUM_1,
			},
		},
		{
			name = "item_bonus_tier_divine",
			can_be_bought = true,
			count = 1,
			sets ={
				DONATE_SET_MARSHAL,
				DONATE_SET_PREMIUM_1,
			},
		},
		{
			name = "item_angel_wings",
			can_be_bought = true,
			count = 1,
			sets ={
				DONATE_SET_GODLIKE,
				DONATE_SET_MARSHAL,
				DONATE_SET_GODLIKE_ITEM_1
			},
		},
		{
			name = "item_dark_sword",
			can_be_bought = true,
			count = 1,
			sets ={
				DONATE_SET_GODLIKE,
				DONATE_SET_MARSHAL,
				DONATE_SET_GODLIKE_ITEM_2
			},
		},
		{
			name = "item_merlin_cap",
			can_be_bought = true,
			count = 1,
			sets ={
				DONATE_SET_GODLIKE,
				DONATE_SET_MARSHAL,
				DONATE_SET_GODLIKE_ITEM_3
			},
		},
		{
			name = "item_pocket_phoenix",
			can_be_bought = false,
			count = 1,
			sets ={
				DONATE_SET_MARSHAL,
				DONATE_SET_PHOENIX,
			},
		},
		{
			name = "item_greatsword",
			can_be_bought = false,
			count = 1,
			sets ={
				DONATE_SET_MARSHAL,
				DONATE_SET_SVEN_ITEM,
			},
		},
		{
			name = "item_mystic_dagger",
			can_be_bought = false,
			count = 1,
			sets ={
				DONATE_SET_MARSHAL,
				DONATE_SET_SPECTRE_ITEM,
			},
		},
		{
			name = "item_demon_horns",
			can_be_bought = false,
			count = 1,
			sets ={
				DONATE_SET_MARSHAL,
				DONATE_SET_DEMON_ITEM,
			},
		},
		{
			name = "item_special_ta",
			can_be_bought = false,
			count = 1,
			sets ={
				DONATE_SET_MARSHAL,
				DONATE_SET_SHINOBU_ITEM,
			},
		},
		{
			name = "item_special_antares",
			can_be_bought = false,
			count = 1,
			sets ={
				DONATE_SET_MARSHAL,
				DONATE_SET_ANTARES_ITEM,
			},
		},
		{
			name = "item_special_jacob",
			can_be_bought = false,
			count = 1,
			sets ={
				DONATE_SET_MARSHAL,
				DONATE_SET_JACOB_ITEM,
			},
		},
		{
			name = "item_special_mark",
			can_be_bought = false,
			count = 1,
			sets ={
				DONATE_SET_MARSHAL,
			},
		},
		{
			name = "item_special_storm",
			can_be_bought = false,
			count = 1,
			sets ={
				DONATE_SET_MARSHAL,
				DONATE_SET_STORM_ITEM,
			},
		},
		{
			name = "item_special_tangin",
			can_be_bought = false,
			count = 1,
			sets ={
				DONATE_SET_MARSHAL,
				DONATE_SET_TANGIN_ITEM,
			},
		},
		{
			name = "item_special_jotaro",
			can_be_bought = false,
			count = 1,
			sets ={
				DONATE_SET_MARSHAL,
				DONATE_SET_JOTARO_ITEM,
			},
		},
		{
			name = "item_carapace_of_qaldin",
			can_be_bought = false,
			count = 1,
			sets ={
				DONATE_SET_MARSHAL,
			},
		},
		{
			name = "item_the_caustic_finale",
			can_be_bought = false,
			count = 1,
			sets ={
				DONATE_SET_MARSHAL,
			},
		},
		{
			name = "item_apex",
			can_be_bought = false,
			count = 1,
			sets ={
				DONATE_SET_MARSHAL,
			},
		},
		{
			name = "item_ballista",
			can_be_bought = false,
			count = 1,
			sets ={
				DONATE_SET_MARSHAL,
			},
		},
		{
			name = "item_trident",
			can_be_bought = false,
			count = 1,
			sets ={
				DONATE_SET_MARSHAL,
			},
		},
		{
			name = "item_fallen_sky",
			can_be_bought = false,
			count = 1,
			sets ={
				DONATE_SET_MARSHAL,
			},
		},
		{
			name = "item_havoc_hammer",
			can_be_bought = false,
			count = 1,
			sets ={
				DONATE_SET_MARSHAL,
			},
		},
		{
			name = "item_suppa",
			can_be_bought = false,
			count = 1,
			sets ={
				DONATE_SET_MARSHAL,
			},
		},
	},
}

Donate = Donate or class({})

function Donate:OnGameRulesStateChange()
	if GameRules:State_Get() == DOTA_GAMERULES_STATE_CUSTOM_GAME_SETUP then
		self.players = {}
		for p = 0, PlayerResource:GetPlayerCount() - 1 do
			self.players[p] = {}
			local acc_id = PlayerResource:GetSteamAccountID( p )
			local player = self.players[p]

			if acc_id then
				for list, items in pairs( DONATE_ITEMS ) do
					for _, item in pairs( items ) do
						local item_info = {
							name = item.name,
							sets = {}
						}
						local player_has = item.free_available or nil
						for _, set in pairs( item.sets ) do
							for _, id in pairs( set.players or {} ) do
								if id == acc_id then
									player_has = true
								end
							end
							if set.name and set.can_be_bought then
								local set_info = {
									name = set.name,
									can_be_bought = set.can_be_bought,
									prices = set.prices
								}
								table.insert( item_info.sets, set_info )
							end
						end

						if item.can_be_bought or player_has then
							player[list] = player[list] or {}

							if player_has then
								item_info.count = item.count
							else
								item_info.count = -1
							end
							table.insert( player[list], item_info )
						end
					end
				end
			end
			self:UpdateNetTables( p )
		end
	end
end

function addItemBySteamID(enum,item_name,steamID,npc)
	for _,ID in pairs(enum) do
		if steamID == ID then
			Timers:CreateTimer(1,function() npc:AddItemByName(item_name) end)
		end
	end
end

ListenToGameEvent( "game_rules_state_change", Dynamic_Wrap( Donate, "OnGameRulesStateChange" ), Donate )

